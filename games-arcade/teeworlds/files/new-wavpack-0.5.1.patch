--- teeworlds-0.5.1-src.orig/src/engine/client/ec_snd.c.orig	2009-01-15 16:30:58.000000000 +0500
+++ teeworlds-0.5.1-src/src/engine/client/ec_snd.c	2009-01-15 16:35:00.000000000 +0500
@@ -358,14 +358,6 @@
 	snd->num_frames = num_frames;
 }
 
-
-static IOHANDLE file = NULL;
-
-static int read_data(void *buffer, int size)
-{
-	return io_read(file, buffer, size);
-}
-
 int snd_load_wv(const char *filename)
 {
 	SAMPLE *snd;
@@ -381,19 +373,12 @@
 	if(!sound_enabled)
 		return 1;
 
-	file = engine_openfile(filename, IOFLAG_READ); /* TODO: use system.h stuff for this */
-	if(!file)
-	{
-		dbg_msg("sound/wv", "failed to open %s", filename);
-		return -1;
-	}
-
 	sid = snd_alloc_id();
 	if(sid < 0)
 		return -1;
 	snd = &samples[sid];
 
-	context = WavpackOpenFileInput(read_data, error);
+	context = WavpackOpenFileInput(filename, error, OPEN_2CH_MAX, 0);
 	if (context)
 	{
 		int samples = WavpackGetNumSamples(context);
@@ -448,9 +433,6 @@
 		dbg_msg("sound/wv", "failed to open %s: %s", filename, error);
 	}
 
-	io_close(file);
-	file = NULL;
-
 	if(config.debug)
 		dbg_msg("sound/wv", "loaded %s", filename);
 
